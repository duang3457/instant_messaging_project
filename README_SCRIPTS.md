# ğŸš€ èŠå¤©å®¤æœåŠ¡ç®¡ç†å·¥å…·

ä¸€é”®å¯åŠ¨ã€åœæ­¢å’Œç›‘æ§æ•´ä¸ªèŠå¤©å®¤æœåŠ¡æ ˆçš„ä¾¿æ·è„šæœ¬é›†åˆã€‚

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

```bash
# 1. å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start_all.sh

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
./check_status.sh

# 3. åœæ­¢æ‰€æœ‰æœåŠ¡
./stop_all.sh
```

---

## ğŸ“¦ è„šæœ¬è¯´æ˜

### ğŸŸ¢ start_all.sh - ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

æŒ‰æ­£ç¡®çš„ä¾èµ–é¡ºåºå¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼š

```
Zookeeper (2181) 
    â†“
Kafka (9092) 
    â†“
Comet (8082, 50051, 9091) 
    â†“
Logic (8090) 
    â†“
Job (Kafka Consumer)
```

**ç‰¹æ€§**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹æœåŠ¡æ˜¯å¦å·²è¿è¡Œï¼ˆé¿å…é‡å¤å¯åŠ¨ï¼‰
- âœ… æ™ºèƒ½ç­‰å¾…æ¯ä¸ªæœåŠ¡å®Œå…¨å°±ç»ª
- âœ… æ‰€æœ‰æ—¥å¿—ä¿å­˜åˆ° `~/chatroom/logs/`
- âœ… å¯åŠ¨å¤±è´¥æ—¶æ¸…æ™°çš„é”™è¯¯æç¤º

**ç”¨æ³•**ï¼š
```bash
./start_all.sh
```

---

### ğŸ”µ check_status.sh - æœåŠ¡çŠ¶æ€æ£€æŸ¥

å…¨é¢æ£€æŸ¥æ‰€æœ‰æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼š

**æ£€æŸ¥é¡¹ç›®**ï¼š
- ç«¯å£ç›‘å¬çŠ¶æ€
- è¿›ç¨‹è¿è¡ŒçŠ¶æ€  
- HTTP å¥åº·ç«¯ç‚¹
- æœåŠ¡ç»Ÿè®¡æ‘˜è¦

**ç”¨æ³•**ï¼š
```bash
./check_status.sh

# è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯ 5 ç§’ï¼‰
watch -n 5 './check_status.sh'
```

**é€€å‡ºç **ï¼š
- `0` - æ‰€æœ‰æœåŠ¡æ­£å¸¸
- `1` - æ‰€æœ‰æœåŠ¡åœæ­¢
- `2` - éƒ¨åˆ†æœåŠ¡è¿è¡Œ

---

### ğŸ”´ stop_all.sh - å®‰å…¨åœæ­¢æ‰€æœ‰æœåŠ¡

æŒ‰åå‘ä¾èµ–é¡ºåºä¼˜é›…åœæ­¢æ‰€æœ‰æœåŠ¡ï¼š

```
Job 
    â†“
Logic 
    â†“
Comet 
    â†“
Kafka 
    â†“
Zookeeper
```

**ç‰¹æ€§**ï¼š
- âœ… ä¼˜å…ˆä½¿ç”¨ SIGTERM ä¼˜é›…åœæ­¢
- âœ… è¶…æ—¶åè‡ªåŠ¨ä½¿ç”¨ SIGKILL å¼ºåˆ¶åœæ­¢
- âœ… éªŒè¯æ‰€æœ‰æœåŠ¡ç¡®å®å·²åœæ­¢

**ç”¨æ³•**ï¼š
```bash
./stop_all.sh
```

---

## ğŸ¯ å…¸å‹å·¥ä½œæµ

### å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒ
./start_all.sh

# å¼€å‘è¿‡ç¨‹ä¸­æ£€æŸ¥æœåŠ¡
./check_status.sh

# é‡å¯æŸä¸ªæœåŠ¡ï¼ˆä»¥ Comet ä¸ºä¾‹ï¼‰
pkill -f 'chat-room'
cd ~/chatroom/server/build && ./application/chat-room/chat-room > ~/chatroom/logs/comet.log 2>&1 &

# ç»“æŸå¼€å‘ï¼Œåœæ­¢æ‰€æœ‰æœåŠ¡
./stop_all.sh
```

### æ•…éšœæ’æŸ¥

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
./check_status.sh

# 2. æŸ¥çœ‹æ—¥å¿—
tail -f ~/chatroom/logs/comet.log

# 3. æ£€æŸ¥ç«¯å£
netstat -tlnp | grep -E '2181|9092|8082|8090|50051'

# 4. é‡å¯é—®é¢˜æœåŠ¡
./stop_all.sh
./start_all.sh
```

---

## ğŸ“Š æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å®¢æˆ·ç«¯ (WebSocket)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Comet (8082)     â”‚  Redis PubSub  â”‚  HTTP Client   â”‚
â”‚  - WebSocket æ¥å…¥  â”‚  å®æ—¶å¹¿æ’­      â”‚  å¼‚æ­¥è½¬å‘      â”‚
â”‚  - gRPC Server    â”‚  (ä½å»¶è¿Ÿ)      â”‚  (é«˜å¯é )      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
         â”‚ gRPC                               â”‚ HTTP POST
         â”‚ (Job è°ƒç”¨)                          â”‚
         â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                          â”‚  Logic (8090)    â”‚
         â”‚                          â”‚  - ä¸šåŠ¡é€»è¾‘       â”‚
         â”‚                          â”‚  - Kafka Producerâ”‚
         â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
         â”‚                                    â†“
         â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                          â”‚  Kafka (9092)   â”‚
         â”‚                          â”‚  - my-topic     â”‚
         â”‚                          â”‚  - 4 partitions â”‚
         â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
         â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                          â”‚  Job (Consumer)  â”‚
         â”‚                          â”‚  - 4 threads     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - gRPC Client   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ—¥å¿—ç®¡ç†

æ‰€æœ‰æœåŠ¡æ—¥å¿—ä¿å­˜åœ¨ `~/chatroom/logs/`ï¼š

```bash
~/chatroom/logs/
â”œâ”€â”€ zookeeper.log    # Zookeeper æ—¥å¿—
â”œâ”€â”€ kafka.log        # Kafka æ—¥å¿—
â”œâ”€â”€ comet.log        # Comet æœåŠ¡æ—¥å¿—
â”œâ”€â”€ logic.log        # Logic æœåŠ¡æ—¥å¿—
â””â”€â”€ job.log          # Job æœåŠ¡æ—¥å¿—
```

**å¸¸ç”¨å‘½ä»¤**ï¼š

```bash
# æŸ¥çœ‹æœ€æ–° 100 è¡Œ
tail -100 ~/chatroom/logs/comet.log

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
tail -f ~/chatroom/logs/comet.log

# åŒæ—¶æŸ¥çœ‹å¤šä¸ªæ—¥å¿—
tail -f ~/chatroom/logs/{comet,logic,job}.log

# æœç´¢é”™è¯¯
grep -i error ~/chatroom/logs/*.log

# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
grep "$(date +%Y-%m-%d)" ~/chatroom/logs/comet.log
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8082

# å¼ºåˆ¶åœæ­¢
pkill -9 -f 'chat-room'
```

### Q: Kafka å¯åŠ¨å¤±è´¥ï¼Ÿ

**åŸå› **ï¼šZookeeper æœªå¯åŠ¨

```bash
# æ£€æŸ¥ Zookeeper
netstat -tlnp | grep 2181

# å¯åŠ¨ Zookeeper
~/kafka/bin/zookeeper-server-start.sh ~/kafka/config/zookeeper.properties &
```

### Q: å¦‚ä½•æ¸…ç©ºæ‰€æœ‰æ—¥å¿—ï¼Ÿ

```bash
# æ¸…ç©ºæ—¥å¿—æ–‡ä»¶
> ~/chatroom/logs/comet.log
> ~/chatroom/logs/logic.log
> ~/chatroom/logs/job.log
> ~/chatroom/logs/kafka.log
> ~/chatroom/logs/zookeeper.log

# æˆ–åˆ é™¤æ‰€æœ‰æ—¥å¿—
rm -f ~/chatroom/logs/*.log
```

### Q: å¦‚ä½•è®¾ç½®å¼€æœºè‡ªå¯ï¼Ÿ

**æ¨èä½¿ç”¨ systemd**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼š

```bash
# åˆ›å»º systemd æœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/chatroom.service

# å†…å®¹ï¼š
[Unit]
Description=Chatroom Services
After=network.target

[Service]
Type=forking
User=yang
WorkingDirectory=/home/yang/chatroom
ExecStart=/home/yang/chatroom/start_all.sh
ExecStop=/home/yang/chatroom/stop_all.sh
Restart=on-failure

[Install]
WantedBy=multi-user.target

# å¯ç”¨æœåŠ¡
sudo systemctl enable chatroom
sudo systemctl start chatroom
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“˜ [è„šæœ¬è¯¦ç»†ä½¿ç”¨æŒ‡å—](SCRIPTS_GUIDE.md) - å®Œæ•´çš„è„šæœ¬åŠŸèƒ½è¯´æ˜å’Œæ•…éšœæ’æŸ¥
- ğŸ“— [æ··åˆæ¨¡å¼æ¶æ„æ–‡æ¡£](HYBRID_MODE.md) - æ¶ˆæ¯æ¨é€æ¶æ„è®¾è®¡
- ğŸ“™ [ç›‘æ§ç³»ç»Ÿéƒ¨ç½²æŒ‡å—](monitoring/README.md) - Prometheus + Grafana ç›‘æ§
- ğŸ“• [å®Œæ•´é¡¹ç›®äº¤ä»˜æ–‡æ¡£](monitoring/DELIVERY.md) - é¡¹ç›®æ€»è§ˆå’Œæ¶æ„è¯´æ˜

---

## ğŸ‰ ç‰¹æ€§äº®ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| ğŸ”„ **æ™ºèƒ½å¯åŠ¨** | è‡ªåŠ¨æ£€æµ‹ä¾èµ–ï¼ŒæŒ‰æ­£ç¡®é¡ºåºå¯åŠ¨ |
| ğŸ›¡ï¸ **å®‰å…¨åœæ­¢** | ä¼˜é›…å…³é—­ï¼Œé¿å…æ•°æ®ä¸¢å¤± |
| ğŸ“Š **å®æ—¶ç›‘æ§** | å…¨é¢çš„çŠ¶æ€æ£€æŸ¥å’Œå¥åº·ç›‘æµ‹ |
| ğŸ“ **æ—¥å¿—ç®¡ç†** | æ‰€æœ‰æ—¥å¿—é›†ä¸­ä¿å­˜ï¼Œä¾¿äºæ’æŸ¥ |
| ğŸ¨ **å½©è‰²è¾“å‡º** | æ¸…æ™°çš„å¯è§†åŒ–çŠ¶æ€å±•ç¤º |
| âš¡ **å¿«é€Ÿæ¢å¤** | ä¸€é”®é‡å¯æ‰€æœ‰æœåŠ¡ |

---

## ğŸ™ è´¡çŒ®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestï¼

